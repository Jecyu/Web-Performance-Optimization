# 图片优化

|文件类型|优缺点|
|--|--|
|PNG|通常用于万维网。无损压缩，带透明通道|
|JPG|通常用于万维网。有损压缩，无透明通道|
|GIF|通常用于万维网。有损压缩，无透明通道（在技术上将，损耗并不是压缩造成的，而是当图片转为八位时导致数据丢失。最终和压缩一样损耗）|
|BMP| Windows 上默认的图像格式。无压缩，无透明通道。|
|TGA| 通常用于 3D 图形。其他地方不常用。无损压缩或不压缩，带透明通道。|
|TIFF|通常用于数字相片和出版。无损压缩或不压缩，无透明通道。|
|PICT|旧 Macs 系统上的默认图像格式。有损压缩，无透明通道。|
|PSD|Photoshop 原生文件格式。无压缩，有|
|SVG| |
|Base64| |
|WebP| |


## 不同业务场景下的图片方案选型

### 前置知识

图像大小采用分辨率描述，由多个像素组成。分辨率指屏幕上像素的数目，为了控制像素的亮度和彩色深度，每个像素需要很多个二进制位来表示，如果要显示 256 种颜色，则每个像素至少需要 8 位（`一个字节`）来表示，即 2 的 8 次方等于 256；当显示[真彩色](https://baike.sogou.com/v727368.htm)时，每个像素需要 `3个字节`的[存储量](https://baike.sogou.com/v68223633.htm)。

在计算机中，像素用二进制数来表示。不同的图片格式中像素与二进制之间的对应关系是不同的。一个像素对应的二进制位数越多，它可以表示的颜色种类就越多，成像效果就越细腻，文件体积相应也会越大。

一个二进制位表示两种颜色（0|1 对应 黑|白），如果一种图片格式对应的二进制位数有 n 个，那么它就可以诚信 2^n 种颜色。

那对于矢量图形如 svg 来说，它的像素是计算可以完全模拟出来的？

|文件类型|优缺点|业务场景|
|--|--|--|
||||

### JPEG/JPG 

关键字：有损压缩、体积小、加载快、不支持透明

JPG 格式以 `24` 位存储单个图，可以呈现多达 1600 万种颜色，足以应对大多数场景下对色彩的要求。

#### 使用场景

JPG 使用于呈现色彩丰富的图片，在我们日常开发中，JPG 图片经常作为大的背景图、轮播图或 Banner 图出现。

可以查看京东首页和淘宝首页。

#### JPG 的缺陷

有损压缩在上文所展示的轮播图上确实很难漏出马脚，但当它处理`矢量图形`和 Logo 等线条感较强、颜色对比强烈的图像时，人为压缩导致的图片模糊会相当明显。

### PNG-8 与 PNG-24

关键字：无损压缩、质量高、体积大、支持透明

#### PNG 的优点

PNG（可移植网络图形格式）是一种无损压缩的高保真的图片格式。8 和  24，这里都是二进制数的位数。我们前置知识提到的对应关系，8 位的 PNG 最多支持 256 种颜色，而 24 位的可以呈现约 1600 万种。

PNG 图片具有比 JPG 更强的色彩表现力，对`线条` 的处理更加细腻，对透明度有良好的支持。它弥补了上文我们提到的 JPG 的局限性，唯一的 BUG 就是体积太大。

#### PNG-8 与 PNG-24

如何确定一张图片是该用 PNG-8 还是 PNG-24 去呈现呢？好的做法是把图片先按照这两种格式分别输出，看 PNG-8 输出的额吉锅是否带来肉眼可见的质量损耗，并且确认这种损耗是否在我们（尤其是 UI 设计师）可接受的范围内，基于对比的结果去判断。

#### 应用场景

前面我们提到的，复杂的、色彩层次丰富的图片，用 PNG 来处理的话，成本（体积大）会比较高，我们一般会交给 JPG 去存储。

考虑到 PNG 在处理`线条`和`颜色对比度`方面的优势，我们主要用它来呈现小的 Logo、颜色简单且对比强烈的图片或背景等。（这里是否更应该使用 svg 呢？）

淘宝首页、

### SVG

关键字：文本文件、体积小、不失真、兼容性好。

和性能关系最密切的一点就是：SVG 与 PNG 和 JPG 相比，<u>文件体积更小，可压缩性更强。</u>

当然，作为矢量图，它最显著的优势还是在于<u>图片可无限放大而不失真</u>这一点上。这使得 SVG 即使被放到视网膜屏幕上，也可以一如既往地展现比较好的成像品质——1 张 SVG 足以适配 n 种分辨率。（jpg、png 得输出多个大小的图片）

此外，<u>SVG 是文本文件</u>。我们既可以像写代码一样定义 SVG，把它写在 HTML 里、成为 DOM 的一部分，也可以把图形的描述写入以 `.svg` 为后缀的独立文件（SVG 文件在使用上与普通图片文件无异）。这使得 SVG 文件可以被非常多的工具读取和修改，具有较强的`灵活性`。

SVG 的局限性，<u>一方面是它的渲染成本比较高？，这点对性能来说是很不利的。</u>另一方面，SVG 存在着其他图片格式所没有的学习成本。（它是可编程的）。

#### 应用场景

- 将 SVG 写入 HTML。（arcgis for js 3.0）
- 将 SVG 写入独立文件后引入 HTML
  ```html
  <img src="文件名.svg" alt="">
  ```

实际开发中，使用更多的是后者。关于 svg 与 canvas 的性能问题，可以看 [图表的性能优化](../action/chart.md)

### Base64

关键字：文本文件、依赖编码、小图标解决方案

Base64 并非一种图片格式，而是一种编码方式。Base64 和雪碧图一样，是作为小图标解决方案而存在的。

<!-- Base64 还可以避免跨域问题。 -->

和雪碧图一样，Base64 图片的出现，也是为了<u>减少加载网页图片时对服务器的请求次数，</u>从而提升网页性能。**Base64 是作为雪碧图的补充而存在的**。

Base64 是一种用于传输 8 Bit 字节码的编码方式，通过对图片进行 Base64 编码，我们可以直接将编码结果写入 HTML 或 CSS，从而减少 HTTP 请求的次数。

浏览器自动将 Base64 字符串解码为一个图片，而不需要再去发送 HTTP 请求。

为什么不把大图也换成 base64 呢？这是因为 base64 编码后，图片大小会膨胀为原文件的 4/3（这是由 Base64 的编码原理决定的）。如果我们把大图也编码到 HTML 或 CSS 文件中，后者的体积会明显增加，基本我们减少了 HTTP 请求，也无法弥补这庞大的体积带来的性能开销，得不偿失。（可以通过 performance 测试）

在传输非常小的图片时候，Base64 带来的体积膨胀、以及`浏览器解析 Base64` 的时间开销，与它节省掉的 HTTP请求开销相比，可以忽略不计，这时候才真正体现出它在性能方面的优势。

Base64 编码工具推荐-webpack url

### webp

Webp 像 JPEG 一样对细节丰富的图片信手拈来，像 PNG 一样支持透明，像 GIF 一样可以显示动图——它集多种图片文件格式的优点于一身。

但是只有 chrome 浏览器支持，我们不得不考虑对浏览器兼容性对预判。

## 应用场景

### vuecli 项目如何更好地导出蓝湖上的图片、图标（最佳实践）

- 雪碧图
- svg 文本文件请求
- base64
- iconf

对于小的图标、矢量图，直接导出 svg 为首，结合 `svg-sprite-loader` 处理，容易维护管理。

而对于位图，则考虑 jpg、png，做进一步的压缩。

<!-- 对于线框图，svg 小图标也容易维护。ps 输出的图标。ai 输出 svg。 -->

svg-sprite-loader 是直接 svg 写入 html 中。

### 一些图片处理工具（压缩、转换）

- https://www.picdiet.com/zh-cn  Picdiet是一款在线批量压缩图片神器，它不需要后端服务器或者API的支持，仅通过你的浏览器来压缩图片大小，这意味着它压缩图片极快并且不会导致隐私或敏感图片泄漏。

