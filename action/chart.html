<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图表的性能优化 | 微谈 Web 前端性能优化</title>
    <meta name="description" content="Analysis vue.js deeply">
    <link rel="icon" href="/Web-Performance-Optimization/logo.png">
  <link rel="manifest" href="/Web-Performance-Optimization/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/Web-Performance-Optimization/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/Web-Performance-Optimization/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/Web-Performance-Optimization/assets/css/0.styles.841911cb.css" as="style"><link rel="preload" href="/Web-Performance-Optimization/assets/js/app.7cae2d68.js" as="script"><link rel="preload" href="/Web-Performance-Optimization/assets/js/2.72369abb.js" as="script"><link rel="preload" href="/Web-Performance-Optimization/assets/js/11.02148d24.js" as="script"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/10.a5dacc7d.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/12.acd7b156.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/13.837abe37.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/14.0f6e7494.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/15.b7cfaf21.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/16.18e998c2.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/17.f2b51082.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/18.fd8bf8b2.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/19.ac77f635.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/20.f3fb8221.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/21.b6c75ca9.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/22.5b60da5a.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/23.e8cdc260.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/24.18b6675d.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/25.81f7219b.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/26.cf52eab7.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/27.892d8e46.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/28.36470c5c.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/29.94a5d762.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/3.c2cb7e60.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/30.01fe9788.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/31.21d6cc04.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/32.b9a9aea8.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/33.d303235b.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/34.0696d0a6.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/35.523a3368.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/36.3ec948c0.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/4.df7b7976.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/5.d4962001.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/6.66c2d2c9.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/7.ffbcbdd2.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/8.7a41af06.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/9.a97348ef.js">
    <link rel="stylesheet" href="/Web-Performance-Optimization/assets/css/0.styles.841911cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Web-Performance-Optimization/" class="home-link router-link-active"><!----> <span class="site-name">微谈 Web 前端性能优化</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Jecyu/Web-Performance-Optimization/tree/master/examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  配套例子
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/Jecyu/Web-Performance-Optimization" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Jecyu/Web-Performance-Optimization/tree/master/examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  配套例子
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/Jecyu/Web-Performance-Optimization" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/concept/" class="sidebar-link">Web 性能优化基础认知</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/tool-monitor/" class="sidebar-link">介绍</a></li><li><a href="/Web-Performance-Optimization/tool-monitor/indicator.html" class="sidebar-link">解读 Web 性能体验和质量指标</a></li><li><a href="/Web-Performance-Optimization/tool-monitor/chromeDev.html" class="sidebar-link">唯快不破，Chrome DevTools 性能优化手把手教学</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网络篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/network/" class="sidebar-link">介绍</a></li><li><a href="/Web-Performance-Optimization/network/request.html" class="sidebar-link">资源请求</a></li><li><a href="/Web-Performance-Optimization/network/download.html" class="sidebar-link">资源下载</a></li><li><a href="/Web-Performance-Optimization/network/render.html" class="sidebar-link">资源渲染</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>缓存篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/cache/" class="sidebar-link">介绍</a></li><li><a href="/Web-Performance-Optimization/cache/browser-cache.html" class="sidebar-link">浏览器之 HTTP 缓存机制解读</a></li><li><a href="/Web-Performance-Optimization/cache/browser-localStorage.html" class="sidebar-link">浏览器之本地存储——Cookie、Web Storage、IndexedDB</a></li><li><a href="/Web-Performance-Optimization/cache/webapp.html" class="sidebar-link">Web 运行时缓存</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>渲染篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/browser/" class="sidebar-link">浏览器背后的运行机制</a></li><li><a href="/Web-Performance-Optimization/browser/render.html" class="sidebar-link">浏览器渲染过程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>应用篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/action/bigData.html" class="sidebar-link">大数据量的渲染优化</a></li><li><a href="/Web-Performance-Optimization/action/code.html" class="sidebar-link">代码层面的优化</a></li><li><a href="/Web-Performance-Optimization/action/chart.html" class="active sidebar-link">图表的性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#什么是-svg" class="sidebar-link">什么是 SVG</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#什么是-canvas" class="sidebar-link">什么是 Canvas</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#什么是-webgl？" class="sidebar-link">什么是 WebGL？</a></li></ul></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#svg-vs-canvas" class="sidebar-link">SVG vs Canvas</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#详细对比" class="sidebar-link">详细对比</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#性能对比" class="sidebar-link">性能对比</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#为什么-arcgis-4-0-逐步引入-canvas-替代了-svg-显示地图" class="sidebar-link">为什么 Arcgis 4.0 逐步引入 Canvas 替代了 SVG 显示地图</a></li></ul></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#webgl-性能优化" class="sidebar-link">WebGL 性能优化</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#图表库的选择与性能对比" class="sidebar-link">图表库的选择与性能对比</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#截图" class="sidebar-link">截图</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#html-性能问题" class="sidebar-link">html 性能问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/action/chart.html#小结-2" class="sidebar-link">小结</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>参考资料</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/reference/" class="sidebar-link">Web 性能优化资源合集（持续更新）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="图表的性能优化"><a href="#图表的性能优化" class="header-anchor">#</a> 图表的性能优化</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>有人听说 SVG 和 Canvas 的同学吗？能够说说他们的区别否？</p> <p>图表的性能优化也离不开两个方面：渲染速度 + 交互响应。
策略离不开：懒加载、按需（即局部）</p> <p>概要：</p> <ul><li>绘图技术：
<ul><li>SVG</li> <li>Canvas</li> <li>WebGL</li></ul></li> <li>图表库
<ul><li>Echart</li> <li>G2（AntV 团队）</li> <li>d3</li></ul></li> <li>地图引擎
<ul><li>百度地图</li> <li>Arcgis</li> <li>OpenLayers</li></ul></li></ul> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <h3 id="什么是-svg"><a href="#什么是-svg" class="header-anchor">#</a> 什么是 SVG</h3> <ul><li>一种使用 <code>XML</code> 描述的 2D 图形的语言</li> <li>SVG 基于 XML 意味着，SVG DOM 中的每个元素都是可用的，可以为某个元素附加 JavaScript 事件处理器。</li> <li>在 SVG 中，每个被绘制的图形均为视为对象。如果 SVG 对象的属性发生变化，那么浏览器能够自动重现。（ <code>svgElement.setAttribute(handle.name, handle.value</code>); // 改变属性）</li></ul> <h3 id="什么是-canvas"><a href="#什么是-canvas" class="header-anchor">#</a> 什么是 Canvas</h3> <ul><li>Canvas 通过 JavaScript 来绘制 2D 图形。</li> <li>Canvas 是逐像素进行渲染的。</li> <li>在 canvas 中，一旦图形被绘制完成，它就不会继续得到浏览器的关注。如果其位置发生变化，那么<code>整个场景也需要重新绘制</code>，包括任何或许已被图形覆盖的对象。</li></ul> <h3 id="什么是-webgl？"><a href="#什么是-webgl？" class="header-anchor">#</a> 什么是 WebGL？</h3> <p>WebGL 既可以绘制 2D 图形，也可以绘制 3D 图形。</p> <ul><li>基于 Canvas 的 3D 框架</li> <li>主要用来做 3D 展示、动画、游戏</li></ul> <h2 id="svg-vs-canvas"><a href="#svg-vs-canvas" class="header-anchor">#</a> SVG vs Canvas</h2> <p>Canvas 较新，由 Apple 私有的技术发展而来。而 SVG 历史悠久，2003 年成为 W3C 标准。为什么有了 Canvas 后，还要使用 svg
？</p> <p>最明显的原因是，因为 svg 是不依赖于终端设备的像素，可以随意缩放大小而不会失真，canvas 则会变模糊。为什么会导致这样的差别呢？因为 SVG 的渲染原理是<u>通过对图形的数学描述来绘图的。</u>例如：以下多啦 A 梦的头型的思路是，我们先画一个贝塞尔函数，然后填充颜色。</p> <p>而 Canvas 的渲染原理是<u>通过对每个像素颜色的填充，最后组成图形。</u>例如，以下马里奥的帽子我们可以看出，其实帽子的形状是由一个个像素填充出来的。</p> <p>另外 Canvas 渲染出来的图叫位图，SVG 渲染出来的图叫矢量图。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-15-16-15-08-svg-canvas-02.4aea5ec2.png" alt=""></p> <p>是不是所有图形都用 SVG 画就好了，位图就淘汰了（目前来说是不可能的，像照相机的出图都是 jpg、png 等位图）。SVG 也有它的缺点。</p> <h3 id="详细对比"><a href="#详细对比" class="header-anchor">#</a> 详细对比</h3> <p>Canvas</p> <ul><li>依赖分辨率</li> <li>不支持事件处理器</li> <li>弱的文本渲染能力</li> <li>能够以 <code>·png</code> 或 <code>.jpg</code> 格式保存结果图像</li> <li>最适合图像密集型的游戏，其中的许多对象会被频繁重绘</li></ul> <p>SVG</p> <ul><li>不依赖分辨率</li> <li>支持事件处理器</li> <li>最适合带有大型渲染区域的应用程序（比如谷歌地图）</li> <li>复杂度高会减慢渲染速度（任何过度使用 DOM 的应用都不快）</li> <li>不适合游戏应用</li></ul> <p>对于开发人员：</p> <ul><li>对于画在 Canvas 上的部件，你需要处理重绘。而 SVG 则不用，你修改 SVG DOM 则浏览器会自动帮你重绘。</li> <li>Canvas 不负责帮你侦测鼠标/触摸事件发生在哪一个图形元件上，而 SVG 可以。</li></ul> <p>SVG 可以理解为一个个的图形放到页面上，而 Canvas 则是使用画笔一个个的绘制图形。</p> <h3 id="性能对比"><a href="#性能对比" class="header-anchor">#</a> 性能对比</h3> <p>性能对比要看场景。从底层来看，Canvas 的性能受画布尺寸影响更大，而 SVG 的性能受图形元素影响更大。下图是微软 MSDN 上给的一个对比图：</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-15-15-22-58-svg-canvas.f5122711.png" alt=""></p> <p>比较流行的看法是 SVG 做定制和交互更有优势，</p> <p>Canvas 是个像素库，绘制完了基本不用记录过长，更快。svg 建立了一大堆可交互对象，本性长于交互，但性能会弱些。但是可以对 Canvas 封装一层（例如 zRender ），可以让 Canvas 像 svg 一样操作和交互。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-15-14-09-canvas-svg-01.1b55d1e8.png" alt=""></p> <ul><li>移动端优选 SVG
<ul><li>（内存和 CPU，Canvas 占内存多）</li></ul></li> <li>图表个数很多时优选 SVG</li> <li>导出小文件高清晰时使用 SVG</li> <li>部分特殊渲染效果只有 Canvas 支持</li> <li>数据量特别大时推荐使用 Canvas 渲染</li></ul> <p>SVG 必须维护对它呈现的每个对象的引用。您创建的每个 SVG / VML 元素都是 DOM 中的真实元素。默认情况下，这可以让您更好地跟踪您创建的元素，并且默认情况下更容易处理鼠标事件，但是当存在大量对象时，它会显着减慢速度</p> <p>HTML5 Canvas 只是位图的绘图表面。你设置绘制(用颜色和线条粗细说)，绘制那个东西，然后画布不知道那个东西：它不知道它在哪里或者你刚刚绘制的是什么，它是只是像素。如果你想绘制矩形并让它们四处移动或可选择，那么你必须从头开始编写所有这些代码，包括记住你绘制它们的代码。</p> <p>关于 javascript：HTML5 Canvas vs. SVG vs. div</p> <ul><li>https://www.codenong.com/5882716/</li></ul> <h5 id="大数据量渲染"><a href="#大数据量渲染" class="header-anchor">#</a> 大数据量渲染</h5> <p>首次渲染时，canvas 比 svg 渲染速度更快</p> <p>同样渲染 10 万个圆，在 cpu 为 4x （模拟移动端）的情况下，svg 需要 15 秒，而 canvas 只需 5 秒多。</p> <p>SVG</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-16-56-27-svg-performance-01.f2329676.png" alt=""></p> <p>Canvas</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-16-58-15-canvas-performance-01.c69e8b5a.png" alt=""></p> <p>再次更新</p> <p>对于 SVG 的图形来说，直接修改对应标签的属性即可，有浏览器控制刷新图形。但是对于 Canvas 来说需要清除整个画布，重新绘制所有的图形，也就是说 Canvas 画布上有 10W 个图形，仅仅更新一个图形时，其他 99999 个图形也需要重新绘制。这个性能如何处理的？（TODO）</p> <p><a href="https://www.html5rocks.com/zh/tutorials/canvas/performance/#toc-perf" target="_blank" rel="noopener noreferrer">提高 HTML5 画布性能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h5 id="大尺寸渲染"><a href="#大尺寸渲染" class="header-anchor">#</a> 大尺寸渲染</h5> <h4 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h4> <p>而简单的统计图表性能方面没啥差别，但是在关系分析这种场景下，svg 也就是千这个规模的，canvas 能提高 1-2 个数量级 1W-10W 是可以做到流畅交互的。底层封装了上层使用 svg 还是 canvas 没有差别。</p> <h3 id="为什么-arcgis-4-0-逐步引入-canvas-替代了-svg-显示地图"><a href="#为什么-arcgis-4-0-逐步引入-canvas-替代了-svg-显示地图" class="header-anchor">#</a> 为什么 Arcgis 4.0 逐步引入 Canvas 替代了 SVG 显示地图</h3> <p>地图引擎的核心能力包括：</p> <ul><li>负责地图图像的展现。</li> <li>地图上能够叠加点、线、面覆盖物以及其他图层。</li> <li>地图可以支持拖拽移动、放大缩小操作、叠加元素支持点击的交互。</li></ul> <p>这里是参考百度地图技术的演变<a href="https://mp.weixin.qq.com/s/U8wGi85BavBxFa8DcxAurw" target="_blank" rel="noopener noreferrer">web 地图引擎的技术演进<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，Arcgis 的情况跟它很类似。</p> <h4 id="web-引擎-1-0"><a href="#web-引擎-1-0" class="header-anchor">#</a> web 引擎 1.0</h4> <p>地图图像的实现</p> <p>地图初始化确定了<code>中心点</code>和<code>级别</code>，根据这两个信息就能计算出当前视野需要哪些网络，具体过程如下：</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-14-56-38-map-render.f1f0c0d5.png" alt=""></p> <p>覆盖物的实现</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-14-57-41-map-render-02.74c503ef.png" alt=""></p> <p>图层与覆盖物容器</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-14-58-07-map-03.6c3b7d88.png" alt=""></p> <p>性能优化</p> <ul><li>对点抽稀</li> <li>线剪</li></ul> <p>SVG 的渲染成本比较高，由于是 DOM 方式实现，添加大量覆盖物时，性能比较差。</p> <h4 id="web-引擎-2-0"><a href="#web-引擎-2-0" class="header-anchor">#</a> Web 引擎 2.0</h4> <p>相比图片<code>矢量数据</code>要小得多，且与屏幕像素密度无关，这能大大降低网络加载的耗时，同时数据在前端绘制的耗时也可接受，总体加载耗时要比图片的方案小很多。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-06-16-15-00-18-map-canvas.c8597073.png" alt=""></p> <h4 id="web-引擎-3-0"><a href="#web-引擎-3-0" class="header-anchor">#</a> Web 引擎 3.0</h4> <p>使用 WebGL 实现二三维效果，webGL 的渲染是在 GPU 中进行，可以显著的提升渲染效率。canvas 呢？</p> <h2 id="webgl-性能优化"><a href="#webgl-性能优化" class="header-anchor">#</a> WebGL 性能优化</h2> <ul><li>顶点相关的优化</li> <li>CPU 优化</li> <li>像素优化</li></ul> <h2 id="图表库的选择与性能对比"><a href="#图表库的选择与性能对比" class="header-anchor">#</a> 图表库的选择与性能对比</h2> <h2 id="截图"><a href="#截图" class="header-anchor">#</a> 截图</h2> <ol><li>打印预览功能问题由于要求和前端预览和打印结果一模一样，现在改用前端合成图片，又由于计算服务打印慢和不稳定，上周把出图这块也改成了前端出图，
高版本的浏览器没有问题，但是在低版本的浏览器会出图慢，和瓦片丢失的问题，和精度有稍微低点问题，和实施沟通后，计划图片合成还是由前端合成，图片
导图有计算导出，这样在低版本浏览器里面就剩慢的问题。这次去厦门出差他们也提到了打印慢的问题，如果客户要求精度没有那么高的话，打印预览那个功能可以完全采用前端出图实现，解决慢的问题。</li> <li>htm2Canvas 导出图片时会有跨域的问题，研究可以设置一个参数解决跨域</li></ol> <p>上周专门研究了一下前端出图技术，出了用的最多的 html2Canvas 外，还有 dom-to-image.js 和 rasterizeHTML.js，和 puppetee 其他三个前端库，但是在使用在 dojo 里面都没有 html2Canvas 效果好，知乎 app 的截图功能就是 rasterizeHTML.js 实现的
相关地址：
https://github.com/GoogleChrome/puppeteer
https://github.com/cburgmer/rasterizeHTML.js
https://github.com/tsayen/dom-to-image
https://github.com/niklasvh/html2canvas/</p> <p>关于产品专题制图出图过慢的性能问题</p> <p>症状如图：</p> <p>可以看到上图中，在截图过程中发起了 oms.html 的请求，这个是在 appConfig.json 里面配置的。</p> <p>原因分析：</p> <p>在专题制图的导致 html2Canvas 的时候，它内部会拷贝当前目标节点所在的 Document 节点， 这个 document 包含了当前的 iframe，然后把这个 document 进行重新渲染获取样式保证与截图的一致。因此渲染的过程中，会加载当前的地址，从而影响截图的效率。这样发起了对该共享的网站的请求，如果该地址本身跑不通，就会阻塞地图的截屏过过程。
解决方案：这个跨域地址的设置是产品开发共享 cookie 所需设置。如果项目上根本不需要这个东西，就把 crossdomain 置空即可：</p> <p>最后，源码仓库：https://github.com/niklasvh/html2canvas ，参考阅读：https://zhuanlan.zhihu.com/p/128935733</p> <p><a href="https://www.open-open.com/solution/view/1319458447249" target="_blank" rel="noopener noreferrer">iframe异步加载技术及性能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 避免性能问题。
<a href="https://zhuanlan.zhihu.com/p/128935733" target="_blank" rel="noopener noreferrer">浏览器端网页截图方案详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="html-性能问题"><a href="#html-性能问题" class="header-anchor">#</a> html 性能问题</h3> <h2 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结</h2> <ul><li></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Jecyu/Web-Performance-Optimization/edit/master/docs/action/chart.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">7/14/2020, 6:15:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Web-Performance-Optimization/action/code.html" class="prev">代码层面的优化</a></span> <span class="next"><a href="/Web-Performance-Optimization/reference/">Web 性能优化资源合集（持续更新）</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Web-Performance-Optimization/assets/js/app.7cae2d68.js" defer></script><script src="/Web-Performance-Optimization/assets/js/2.72369abb.js" defer></script><script src="/Web-Performance-Optimization/assets/js/11.02148d24.js" defer></script>
  </body>
</html>
