<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>资源请求 | 微谈 Web 前端性能优化</title>
    <meta name="description" content="Analysis vue.js deeply">
    <link rel="icon" href="/Web-Performance-Optimization/logo.png">
  <link rel="manifest" href="/Web-Performance-Optimization/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/Web-Performance-Optimization/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/Web-Performance-Optimization/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/Web-Performance-Optimization/assets/css/0.styles.841911cb.css" as="style"><link rel="preload" href="/Web-Performance-Optimization/assets/js/app.7cae2d68.js" as="script"><link rel="preload" href="/Web-Performance-Optimization/assets/js/2.72369abb.js" as="script"><link rel="preload" href="/Web-Performance-Optimization/assets/js/8.7a41af06.js" as="script"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/10.a5dacc7d.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/11.02148d24.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/12.acd7b156.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/13.837abe37.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/14.0f6e7494.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/15.b7cfaf21.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/16.18e998c2.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/17.f2b51082.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/18.fd8bf8b2.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/19.ac77f635.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/20.f3fb8221.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/21.b6c75ca9.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/22.5b60da5a.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/23.e8cdc260.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/24.18b6675d.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/25.81f7219b.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/26.cf52eab7.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/27.892d8e46.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/28.36470c5c.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/29.94a5d762.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/3.c2cb7e60.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/30.01fe9788.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/31.21d6cc04.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/32.b9a9aea8.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/33.d303235b.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/34.0696d0a6.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/35.523a3368.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/36.3ec948c0.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/4.df7b7976.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/5.d4962001.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/6.66c2d2c9.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/7.ffbcbdd2.js"><link rel="prefetch" href="/Web-Performance-Optimization/assets/js/9.a97348ef.js">
    <link rel="stylesheet" href="/Web-Performance-Optimization/assets/css/0.styles.841911cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Web-Performance-Optimization/" class="home-link router-link-active"><!----> <span class="site-name">微谈 Web 前端性能优化</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Jecyu/Web-Performance-Optimization/tree/master/examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  配套例子
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/Jecyu/Web-Performance-Optimization" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Jecyu/Web-Performance-Optimization/tree/master/examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  配套例子
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/Jecyu/Web-Performance-Optimization" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/concept/" class="sidebar-link">Web 性能优化基础认知</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/tool-monitor/" class="sidebar-link">介绍</a></li><li><a href="/Web-Performance-Optimization/tool-monitor/indicator.html" class="sidebar-link">解读 Web 性能体验和质量指标</a></li><li><a href="/Web-Performance-Optimization/tool-monitor/chromeDev.html" class="sidebar-link">唯快不破，Chrome DevTools 性能优化手把手教学</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>网络篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/network/" class="sidebar-link">介绍</a></li><li><a href="/Web-Performance-Optimization/network/request.html" class="active sidebar-link">资源请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/network/request.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/network/request.html#请求的发起" class="sidebar-link">请求的发起</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/network/request.html#请求的响应" class="sidebar-link">请求的响应</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/network/request.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/Web-Performance-Optimization/network/request.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/Web-Performance-Optimization/network/download.html" class="sidebar-link">资源下载</a></li><li><a href="/Web-Performance-Optimization/network/render.html" class="sidebar-link">资源渲染</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>缓存篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/cache/" class="sidebar-link">介绍</a></li><li><a href="/Web-Performance-Optimization/cache/browser-cache.html" class="sidebar-link">浏览器之 HTTP 缓存机制解读</a></li><li><a href="/Web-Performance-Optimization/cache/browser-localStorage.html" class="sidebar-link">浏览器之本地存储——Cookie、Web Storage、IndexedDB</a></li><li><a href="/Web-Performance-Optimization/cache/webapp.html" class="sidebar-link">Web 运行时缓存</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>渲染篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/browser/" class="sidebar-link">浏览器背后的运行机制</a></li><li><a href="/Web-Performance-Optimization/browser/render.html" class="sidebar-link">浏览器渲染过程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>应用篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/action/bigData.html" class="sidebar-link">大数据量的渲染优化</a></li><li><a href="/Web-Performance-Optimization/action/code.html" class="sidebar-link">代码层面的优化</a></li><li><a href="/Web-Performance-Optimization/action/chart.html" class="sidebar-link">图表的性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>参考资料</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web-Performance-Optimization/reference/" class="sidebar-link">Web 性能优化资源合集（持续更新）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="资源请求"><a href="#资源请求" class="header-anchor">#</a> 资源请求</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>本文将通过 network 工具分析结合请求发起、请求响应这两个方面来说明如何减少资源请求的时间。这里的请求响应不包括资源下载的时间。</p> <p><img src="/Web-Performance-Optimization/assets/img/performance-roadmap-1.6c4b9572.png" alt="performance-roadmap"></p> <p><strong>目标读者</strong>：希望了解如何减少 Web 资源请求响应时间以及 HTTP2 有什么性能上的提升。</p> <p><strong>文章大纲</strong>：</p> <ul><li>发起请求
<ul><li>DNS 解析</li> <li>TCP</li> <li>HTTP</li></ul></li> <li>请求响应
<ul><li>集群</li> <li>分布式</li> <li>CDN</li></ul></li></ul> <p><strong>阅读时长</strong>：20min</p> <h2 id="请求的发起"><a href="#请求的发起" class="header-anchor">#</a> 请求的发起</h2> <p>以淘宝网为例，在浏览器地址栏输入 <a href="https://www.taobao.com/" target="_blank" rel="noopener noreferrer">www.taobao.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 首次访问系统，查看 network 面板记录的具体信息：</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-05-21-48-48-network-timing.3ed3830c.png" alt=""></p> <p>从上图可知，要成功发起一个 HTTP 请求前，需要等候排队，然后通过 DNS 解析域名获得 IP 地址、其次是 TCP 连接、SSL 验证（若有），最后才能发起一个 HTTP 请求。</p> <p>因此只要任意一个节点出现问题，都有可能增加请求的发送时间。</p> <h3 id="dns-解析"><a href="#dns-解析" class="header-anchor">#</a> DNS 解析</h3> <blockquote><p>DNS 是：1. 一个由分层的 DNS 服务器（DNS Server）实现的分布式数据库。2. 一个使得主机能够实现查询分布式数据库的应用层协议。</p></blockquote> <p>浏览器要成功发起一个 HTTP 应用请求，先要进行 TCP 的连接，而要进行 TCP 的连接，则需要知道目标服务器的 IP 地址，而现在浏览器只知道用户输入的 URL 地址，因此需要解析协议以及路径名，然后向 DNS 服务器查询 Web 服务器的 IP 地址，下面我们访问一个新的地址，比如淘宝 www.taobao.com 地址具体的查询过程如下图：</p> <p><img src="/Web-Performance-Optimization/assets/img/dns.drawio.68f624f8.svg" alt=""></p> <ol><li>在浏览器中输入 www.taobao.com 域名，浏览器如果有缓存就采用浏览器的映射。否则操作系统会先检查自己本地的 hosts 文件是否有这个网址映射关系，如果有，就先调用这个 IP 地址映射，完成域名解析。</li> <li>如果 hosts 里没有这个域名的映射，则查找本地 DNS 解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。</li> <li>如果 hosts 与本地 DNS 解析器缓存都没有相应的网址映射关系，首先会找 TCP/ip 参数中设置的首选 DNS 服务器即本地 DNS 服务器，如果要查询的域名包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。</li> <li>如果要查询的域名，不由本地 DNS 服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个 IP 地址映射，完成域名解析，此解析不具有权威性。</li> <li>如果本地 DNS 服务器中查找失败，则会继续向根 DNS 服务器、TLD DNS 以及权威 DNS 服务器进行查询。</li></ol> <p>现在我们借助 nslookup 命令来大概模拟 DNS 查询的过程：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nslookup</span>
<span class="token operator">&gt;</span> www.taobao.com <span class="token comment"># 要查询的域名</span>
Server:		<span class="token number">8.8</span>.8.8 <span class="token comment"># 往上连接的 DNS 服务器</span>
Address:	<span class="token number">8.8</span>.8.8<span class="token comment">#53 # DNS 服务器 IP 地址与端口</span>

Non-authoritative answer: <span class="token comment"># 非权威答案，从上连接 DNS 服务器本地缓存中读取，非实际查询得到</span>
www.taobao.com	canonical name <span class="token operator">=</span> www.taobao.com.danuoyi.tbcache.com.
Name:	www.taobao.com.danuoyi.tbcache.com
Address: <span class="token number">47.246</span>.24.234 <span class="token comment"># IP 地址</span>
Name:	www.taobao.com.danuoyi.tbcache.com
Address: <span class="token number">47.246</span>.24.233
<span class="token operator">&gt;</span>
</code></pre></div><p>如果想进一步研究，这里有一个交互动画协助理解 <a href="https://media.pearsoncmg.com/aw/ecs_kurose_compnetwork_7/cw/content/interactiveanimations/recursive-iterative-queries-in-dns/index.html" target="_blank" rel="noopener noreferrer">Recursive/Iterative Queries in DNS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>可以看出，如果浏览器或本机系统没有 DNS 缓存，这会是一个非常耗时的过程。</p> <h4 id="dns-prefetch"><a href="#dns-prefetch" class="header-anchor">#</a> DNS prefetch</h4> <p>DNS 自动缓存是需要访问过后的，那对于首次访问的地址来说，我们还可以通过 DNS prefetch 提前告知浏览器让它在空闲时间进行域名的预解析为 IP 地址。这样在真正发起请求时，就可以节省这部分时间。</p> <p>我们可以通过手动或动态添加以下声明，假设我们的资源（比如字体、图片等）存放在不同的域名下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 这是淘宝首页的一段代码 --&gt;</span>
<span class="token comment">&lt;!-- Prefetch DNS for external assets --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//gw.alicdn.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//g.alicdn.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//img.alicdn.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div> <p>或者通过 HTTP Link 头：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Link: <span class="token operator">&lt;</span>https://img.alicdn.com<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token assign-left variable">rel</span><span class="token operator">=</span>dns-prefetch
</code></pre></div> <h3 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h3> <p>经过 DNS 查询到 IP 后，这个时候可以建立 TCP 连接，如下图：</p> <p><img src="/Web-Performance-Optimization/assets/img/tcp.drawio.54e6e10d.svg" alt=""></p> <p>在三次握手后就判断了对方的发送能力和接收能力都是正常的，从而成功建立连接。</p> <p><img src="/Web-Performance-Optimization/assets/img/tcp2.drawio.4e11382a.svg" alt=""></p> <p>在传输过程中，有可能出现以下两种情况：</p> <ul><li>发送方的发送能力（比如 120）与接收方的接收能力（100）不一致。</li> <li>管道传输能力不够。（比如只有 50）</li></ul> <p>针对第一种情况：TCP 采用流量控制，设定<strong>接收窗口</strong>，避免发送端过多向接收端发送数据。发送量不能超过接收窗口量。</p> <p>针对第二种情况：TCP 采取了一种机制叫做“慢启动”：因为不清楚实时的管道能力，于是在刚开始传送数据的时候，从一个很小的单位值做尝试；在之后的传送过程中，逐渐翻倍增大传送数据单位值。遇到失败的情况，就立马减小传输数据单位值。</p> <p>如果想进一步研究，这里有一个交互动画协助理解 <a href="https://media.pearsoncmg.com/aw/ecs_kurose_compnetwork_7/cw/content/interactiveanimations/recursive-iterative-queries-in-dns/index.html" target="_blank" rel="noopener noreferrer">Recursive/Iterative Queries in DNS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="增大初始拥塞窗口"><a href="#增大初始拥塞窗口" class="header-anchor">#</a> 增大初始拥塞窗口</h4> <p>由于采取了慢启动可能会导致客户端与服务器之间经过几百 ms 才能达到最大速度的问题，对于大型流式下载服务的影响不明显，因为慢启动的时间可以分摊到整个传输周期。</p> <p>而对于很多 HTTP 连接，特别是一些短暂、突发的连接而言，常常会出现还没有达到。最大窗口请求就被终止的情况（比如传输完）。也就是说，很多 Web 应用的性能经常受到服务器与客户端之间往返时间的制约。因为慢启动限制了可用的吞吐量，而这对于小文件传输非常不利。</p> <p>这个时候，我们可以考虑增大 TCP 的初始拥塞窗口。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-06-21-49-02-tcp-window.dd08deca.png" alt=""></p> <p>如果想进一步研究，这里有一个交互动画协助理解 <a href="https://media.pearsoncmg.com/aw/ecs_kurose_compnetwork_7/cw/content/interactiveanimations/selective-repeat-protocol/index.html" target="_blank" rel="noopener noreferrer">Selective Repeat Protocol.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="preconnect"><a href="#preconnect" class="header-anchor">#</a> preconnect</h4> <p>除了修改服务端的处理，增大初始拥塞窗口外，我们还可以在客户端提前进行告知浏览器进行 TCP 连接：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>相比于 DNS Prefetching，Preconnect 除了提前完成域名的 DNS 解析，还更进一步地完成 http 连接通道的建立，包括 TCP 握手、TLS（Transfer Layer Security） 协商等。</p> <h3 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h3> <p>HTTP 是使用 TCP 作为它的支撑运输协议，一旦 TCP 连接建立起来，浏览器与服务端就可以通过套接字接口访问 TCP，并在各自的套接字门口发送 HTTP 请求报文以及接收 HTTP 响应报文。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-06-22-47-14-http1.0.bbc82c69.png" alt=""></p> <p>HTTP 版本目前经历过 HTTP/0.9、HTTP/1.0 以及 HTTP/1.1 的发展，关于 HTTP 简史，可以参考文章 <a href="https://blog.poetries.top/browser-working-principle/guide/part6/lesson29.html#%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-http-0-9" target="_blank" rel="noopener noreferrer">https://blog.poetries.top/browser-working-principle/guide/part6/lesson29.html#%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-http-0-9<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 以及 <a href="https://www.w3.org/Protocols/" target="_blank" rel="noopener noreferrer">w3c/Protocols<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>HTTP/1.0 每进行一次 HTTP 通信都需要经历 TCP 连接、传输 HTTP 数据和断开 TCP 连接三个阶段。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-06-22-55-52-http1.0.ac192d47.png" alt=""></p> <h4 id="http-1-1"><a href="#http-1-1" class="header-anchor">#</a> HTTP/1.1</h4> <p>随着浏览器单个页面中的图片文件越来越多，特别是单应用时代，有时候一个页面可能包含了几百个外部引用的资源文件，如果在下载每个文件的时候，都需要经历建立 TCP 连接、传输数据和断开连接这样的步骤，无疑会增大大量无谓的开销。</p> <p>为了解决这个问题，HTTP/1.1 增加了持久连接的方法，它的特点是在一个 TCP 连接上可以传输多个 HTTP 请求，只要浏览器或者服务器没有明确断开连接，那么该 TCP 连接会一直保持。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-06-23-02-48-keep-alive.116a7755.png" alt=""></p> <p>从上图可以看出，HTTP 的持久连接可以有效减少 TCP 建立连接和断开连接的次数，这样的好处是减少了服务器额外的负担，并提升整体 HTTP 的请求效率。</p> <p>持久连接在 HTTP/1.1 中是默认开启<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Keep-Alive" target="_blank" rel="noopener noreferrer">Keep-Alive<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的（HTTP/1.0 需要在请求头声明<code>Connection: Keep-Alive</code>），所以你不需要专门为了持久连接去 HTTP 请求头设置信息，如果你不想要采用持久连接，可以在 HTTP 请求头中加上 Connection: close。也可以在响应头中设置 <code>Keep-Alive: timeout=30</code> 的连接时间，以秒为单位。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>HTTP/1.1 <span class="token number">200</span> OK
Connection: Keep-Alive
Content-Encoding: <span class="token function">gzip</span>
Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Date: Thu, <span class="token number">11</span> Aug <span class="token number">2016</span> <span class="token number">15</span>:23:13 GMT
Keep-Alive: <span class="token assign-left variable">timeout</span><span class="token operator">=</span><span class="token number">5</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">1000</span>
Last-Modified: Mon, <span class="token number">25</span> Jul <span class="token number">2016</span> 04:32:39 GMT
Server: Apache

<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
</code></pre></div><p>目前浏览器中对于同一个域名，默认允许同时建立 6 个 TCP 持久连接。</p> <h4 id="http-2"><a href="#http-2" class="header-anchor">#</a> HTTP/2</h4> <p>HTTP/2 的出现是为了解决 HTTP/1.1 的主要问题：</p> <ol><li><p>TCP 的慢启动。这个在前面 TCP 已经说过，对于一些关键资源不大的文件，比如 HTML 文本、CSS 文件和 JavaScript 文件，通常这些文件在 TCP 连接建立好之后就要发起请求的，但这个过程是慢启动，所以耗费的时间比正常的时间要多，这样就推迟了首屏渲染。</p></li> <li><p>多个 TCP 连接，会竞争固定的带宽，会影响某些关键资源的优先下载。</p></li> <li><p>最严重的一个问题就是 HTTP/1.1 队列阻塞的问题，虽然可以公用一个 TCP 管道，但是在一个管道中同一时刻只能处理一个请求，在当前的请求没有结束之前，其他的请求只能处于阻塞状态，直到该请求结束或被超时被取消（之前就遇到过测试环境与生产环境的地址不同的请求导致阻塞）。</p></li></ol> <p>假如有一个请求被阻塞了 5 秒，那么后续排队的请求都要延迟等待 5 秒，在这个等待的过程中，带宽、CPU 都被浪费了。</p> <p>在浏览器处理生成页面的过程中，是非常希望能提前接收到数据进行预处理的，比如对图片提前进行编解码等，从而提升后续使用时的速度。</p> <p><strong>至于 HTTP/2 是如何解决的呢？</strong></p> <p>HTTP/2 的思路就是一个域名只使用一个 TCP 长连接来传输数据，采用多路复用机制，允许同时通过单一的 HTTP/2 连接发起多重的请求-响应信息。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-09-23-34-24.a26cd116.png" alt=""></p> <p>这样整个页面资源的下载过程只需要一次慢启动，同时也避免了多个 TCP 连接竞争带宽所带来的问题。</p> <p>HTTP/2 使用<strong>多路复用机制</strong>（从不同套接字中收集数据块进行拼接），从途中你会发现每个请求都有一个对应的 ID，如 stream1 表示 index.html 的请求，stream2 表示 foo.css 的请求。浏览器任何时候都可以将请求发送给服务器，而不需要等待其他请求的完成，而服务器也可以随意发送请求，因为每份数据都有对应的 ID，浏览器接收后，会筛选出相同 ID 的内容，将其拼接为完整的 HTTP 响应数据。具体实现见<a href="https://blog.poetries.top/browser-working-principle/guide/part6/lesson30.html#%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0" target="_blank" rel="noopener noreferrer">HTTP/2 多路复用的实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-06-23-50-09-http2.e8ec6b07.png" alt=""></p> <p><strong>其他的性能优化：</strong></p> <ul><li>可以设置请求的优先级。</li> <li>服务器推送
<ul><li>服务器可以主动把关联页面的资源一并提前发送，比如请求了 HTML 页面，可以把几个重要的 JS 文件和 CSS 文件一并发送。</li></ul></li> <li>请求头和响应头进行压缩。
<ul><li>虽然一个 HTTP 的头文件不大，但是积少成多，比如 100 个资源的 HTTP 请求头都压缩为原来的 20%，那么传输效率则大幅提升。</li></ul></li></ul> <p>HTTP/2 协议规范于 2015 年 5 月正式发布，我们可以看看淘宝网。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-07-00-07-46-http2.d08f3bc9.png" alt=""></p> <h4 id="prefetch-与-preload"><a href="#prefetch-与-preload" class="header-anchor">#</a> prefetch 与 preload</h4> <p>假若我们暂时不能升级到 HTTP/2，但我们还可以通过 pre-机制做些优化的。</p> <p><strong>prefetch</strong>：对资源预提取，向浏览器指示即使页面中未检测到它也可以下载给定资源，然后缓存起来。资源下载优先级低，在浏览器空闲时下载但不进行解析。</p> <p>当 SPA 项目使用了路由分割动态加载的时候，我们从一个页面跳转到另一个页面的时候，浏览器会动态加载新页面所需要的 js 资源，然后执行渲染。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/AnaDataEyeAnalysis.4be3a798.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/AnaIndexData.6f0eac4f.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/BaseDateHandleAiProduct.4d3d1ff4.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p><strong>preload</strong>：对资源预加载，告诉浏览器必须尽快下载具有高优先级的给定资源，把资源下载下来并进行解析，但不会执行。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 摘取 vue-cli 项目 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/app.483ea229.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>style<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/chunk-vendors.e9de61f9.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>style<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/chunk-vendors.1c060fbe.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/app.a748d987.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>对比：</p> <ul><li>当前页面肯定用到的资源用 <code>preload</code> （资源优先级 highest）</li> <li>下一个页面会用到的 <code>prefetch</code>（资源优先级 lowest）</li></ul> <p>在 vue-cli3 生成的项目中，进行路由设置懒加载：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  redirect<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;AnaIndexData&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">component</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span>
      <span class="token comment">/* webpackChunkName: &quot;ToolMap&quot; */</span> <span class="token string">&quot;FZBZ/NatureAnalysisEvaluation/AIAnalysis&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack 插件会自动处理，动态生成 preload 和 prefetch 的 link 标签插入到 html 中。</p> <h2 id="请求的响应"><a href="#请求的响应" class="header-anchor">#</a> 请求的响应</h2> <p>我们知道在发起请求方，做的优化毕竟有限。那我们是否可以从响应方入手，比如使用集群、分布式方案以及把静态资源部署到 CDN 上呢？答案是肯定的。</p> <h3 id="集群"><a href="#集群" class="header-anchor">#</a> 集群</h3> <p>随着业务的提升，用户量的访问增加，我们需要更多的服务器来提升响应速度，这就是集群。</p> <p><strong>集群</strong>主要是指同一个系统，部署在多台服务器上，那请求过来的时候这些服务器如何协同分工呢？这就涉及<code>负载均衡</code>的概念了，负载均衡是指将请求分摊到多个操作单元进行执行。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-07-01-18-27-collection-server.9e5c9e30.png" alt=""></p> <p><code>nginx</code> 是常用的反向代理服务，可以用来做负载均衡。</p> <h3 id="分布式"><a href="#分布式" class="header-anchor">#</a> 分布式</h3> <p>除了把同一个系统部署到多台服务器上形成集群，还可以将一个系统拆分成多个业务单元，这就是<strong>分布式</strong>的概念。例如一个门户网站里面可能有登录、视频、图片等，每一个都可以拆分出来独立部署，而且每一个都可以弄成集群，视频服务集群，图片服务集群。分布式还可以是把主系统与子系统分离，比如微前端、微服务。</p> <p>简单的分布式处理可以是把静态资源与动态资源分离：</p> <ul><li>动静分离是将网站静态资源（HTML、JavaScript、CSS、img 等文件）与后台应用分开部署。</li> <li>动静分离的一种做法是将静态资源部署在 nginx 上，后台项目部署到应用服务器上，根据一定规则使对静态资源的请求全部交给 nginx 处理，而将动态请求转发给应用服务器处理，达到动静分离的目标，从而提供网站的并发性能。</li></ul> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-07-01-29-30-fenbushi.f3cfebcf.png" alt=""></p> <h3 id="cdn"><a href="#cdn" class="header-anchor">#</a> CDN</h3> <p>为了进一步提升服务器的响应速度，我们还可以把静态资源可以部署到 CDN 上。使用 Content Delivery Network） 是为了让我们的请求路径更短，从而提高用户访问网站的响应速度。类似分布各地的物流仓储网络，CDN 网络可以将源站的内容缓存到分布全球的 CDN 节点，根据用户的访问 IP，就近连接 CDN，提高网站响应速度。</p> <p>普通的用户访问流程和使用 CDN 的网站访问如下图，其中蓝色链路是无 CDN 的链路。</p> <p><img src="/Web-Performance-Optimization/assets/img/2020-10-07-01-03-32-cdn.764425c2.png" alt=""></p> <p>如何为网站部署 CDN，需要向服务商购买 CDN 服务，把我们的源站 ip 以及域名提供即可。</p> <p>一般的网站只有一台或一组服务器，用户访问站点时请求需要跨越复杂的路由链路，抵达网站服务器，经过 tcp 三次握手建立连接，服务器才会将站点数据传输给用户。</p> <p>使用 CDN 加速后，CDN 在全球的分布式芥蒂娜将会拷贝一份源站的数据（图片、js、html 等静态资源）作为缓存，用户在访问源站会被 DNS 解析到最近的 CDN 服务器，并且访问缓存资源。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>本文通过请求的发起谈及了 DNS 解析、TCP 以及 HTTP 在前端层面可以做的优化，再反过来从请求的响应讲述了使用集群、分布式和 CDN 的性能需求。下一篇，我们将通过《资源下载》谈谈如何减少 HTTP 请求次数以及减少单次请求所花费的时间。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="/Web-Performance-Optimization/reference/#网络">Web 性能优化资源合集（持续更新）</a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Jecyu/Web-Performance-Optimization/edit/master/docs/network/request.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/13/2020, 10:40:21 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Web-Performance-Optimization/network/" class="prev router-link-active">介绍</a></span> <span class="next"><a href="/Web-Performance-Optimization/network/download.html">资源下载</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Web-Performance-Optimization/assets/js/app.7cae2d68.js" defer></script><script src="/Web-Performance-Optimization/assets/js/2.72369abb.js" defer></script><script src="/Web-Performance-Optimization/assets/js/8.7a41af06.js" defer></script>
  </body>
</html>
